diff -durpN php-7.1.27.orig/acinclude.m4 php-7.1.27/acinclude.m4
--- php-7.1.27.orig/acinclude.m4	2019-03-26 06:52:00.157448062 -0400
+++ php-7.1.27/acinclude.m4	2019-03-26 07:37:30.106299603 -0400
@@ -656,9 +656,18 @@ AC_DEFUN([PHP_SET_LIBTOOL_VARIABLE],[
 ])
 
 dnl -------------------------------------------------------------------------
-dnl Wrapper macros for AC_ARG_WITH / AC_ARG_ENABLE
+dnl Wrapper macros for AC_ARG_WITH / AC_ARG_ENABLE / AC_TRY_RUN
 dnl -------------------------------------------------------------------------
 
+dnl PHP_TRY_RUN
+AC_DEFUN([PHP_TRY_RUN],[
+  if test "x$PHP_CROSSCOMPILING" = "xyes" ; then
+    AC_LINK_IFELSE(AC_LANG_SOURCE($1),$2,$3)
+  else
+    AC_TRY_RUN([$1],$2,$3,$4)
+  fi
+])
+
 dnl PHP_ARG_ANALYZE_EX
 dnl internal
 AC_DEFUN([PHP_ARG_ANALYZE_EX],[
@@ -1218,7 +1227,7 @@ dnl
 dnl PHP_DOES_PWRITE_WORK
 dnl internal
 AC_DEFUN([PHP_DOES_PWRITE_WORK],[
-  AC_TRY_RUN([
+  PHP_TRY_RUN([
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
@@ -1248,7 +1257,7 @@ dnl PHP_DOES_PREAD_WORK
 dnl internal
 AC_DEFUN([PHP_DOES_PREAD_WORK],[
   echo test > conftest_in
-  AC_TRY_RUN([
+  PHP_TRY_RUN([
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
diff -durpN php-7.1.27.orig/configure.in php-7.1.27/configure.in
--- php-7.1.27.orig/configure.in	2019-03-05 14:28:38.000000000 -0500
+++ php-7.1.27/configure.in	2019-03-26 07:37:30.107299604 -0400
@@ -221,6 +221,9 @@ PHP_ARG_ENABLE(rpath, whether to enable
 [  --disable-rpath         Disable passing additional runtime library
                           search paths], yes, no)
 
+PHP_ARG_ENABLE(crosscompiling, whether to enable cross compiling,
+[  --enable-crosscompiling Enable cross compiling], yes, no)
+
 dnl check for -R, etc. switch
 PHP_RUNPATH_SWITCH
 
diff -durpN php-7.1.27.orig/ext/curl/config.m4 php-7.1.27/ext/curl/config.m4
--- php-7.1.27.orig/ext/curl/config.m4	2019-03-05 14:28:47.000000000 -0500
+++ php-7.1.27/ext/curl/config.m4	2019-03-26 07:37:30.107299604 -0400
@@ -78,7 +78,7 @@ if test "$PHP_CURL" != "no"; then
 
     AC_PROG_CPP
     AC_MSG_CHECKING([for openssl support in libcurl])
-    AC_TRY_RUN([
+    PHP_TRY_RUN([
 #include <curl/curl.h>
 
 int main(int argc, char *argv[])
@@ -105,7 +105,8 @@ int main(int argc, char *argv[])
     ])
 
     AC_MSG_CHECKING([for gnutls support in libcurl])
-    AC_TRY_RUN([
+    
+    PHP_TRY_RUN([
 #include <curl/curl.h>
 
 int main(int argc, char *argv[])
diff -durpN php-7.1.27.orig/ext/iconv/config.m4 php-7.1.27/ext/iconv/config.m4
--- php-7.1.27.orig/ext/iconv/config.m4	2019-03-26 06:49:23.827517107 -0400
+++ php-7.1.27/ext/iconv/config.m4	2019-03-26 07:37:30.107299604 -0400
@@ -50,7 +50,7 @@ if test "$PHP_ICONV" != "no"; then
       AC_MSG_CHECKING([if using GNU libiconv])
       php_iconv_old_ld="$LDFLAGS"
       LDFLAGS="-liconv $LDFLAGS"
-      AC_TRY_RUN([
+      PHP_TRY_RUN([
 #include <$PHP_ICONV_H_PATH>
 int main() {
   printf("%d", _libiconv_version);
@@ -128,7 +128,7 @@ int main() {
     esac
 
     AC_MSG_CHECKING([if iconv supports errno])
-    AC_TRY_RUN([
+    PHP_TRY_RUN([
 #include <$PHP_ICONV_H_PATH>
 #include <errno.h>
 
diff -durpN php-7.1.27.orig/ext/opcache/config.m4 php-7.1.27/ext/opcache/config.m4
--- php-7.1.27.orig/ext/opcache/config.m4	2019-03-05 14:28:43.000000000 -0500
+++ php-7.1.27/ext/opcache/config.m4	2019-03-26 07:37:30.108299604 -0400
@@ -29,7 +29,7 @@ if test "$PHP_OPCACHE" != "no"; then
   AC_CHECK_HEADERS([unistd.h sys/uio.h])
 
   AC_MSG_CHECKING(for sysvipc shared memory support)
-  AC_TRY_RUN([
+  PHP_TRY_RUN([
 #include <sys/types.h>
 #include <sys/wait.h>
 #include <sys/ipc.h>
@@ -99,7 +99,7 @@ int main() {
   AC_MSG_RESULT([$msg])
 
   AC_MSG_CHECKING(for mmap() using MAP_ANON shared memory support)
-  AC_TRY_RUN([
+  PHP_TRY_RUN([
 #include <sys/types.h>
 #include <sys/wait.h>
 #include <sys/mman.h>
@@ -151,7 +151,7 @@ int main() {
   AC_MSG_RESULT([$msg])
 
   AC_MSG_CHECKING(for mmap() using /dev/zero shared memory support)
-  AC_TRY_RUN([
+  PHP_TRY_RUN([
 #include <sys/types.h>
 #include <sys/wait.h>
 #include <sys/mman.h>
@@ -206,7 +206,7 @@ int main() {
   AC_MSG_RESULT([$msg])
 
   AC_MSG_CHECKING(for mmap() using shm_open() shared memory support)
-  AC_TRY_RUN([
+  PHP_TRY_RUN([
 #include <sys/types.h>
 #include <sys/wait.h>
 #include <sys/mman.h>
@@ -275,7 +275,7 @@ int main() {
   AC_MSG_RESULT([$msg])
 
   AC_MSG_CHECKING(for mmap() using regular file shared memory support)
-  AC_TRY_RUN([
+  PHP_TRY_RUN([
 #include <sys/types.h>
 #include <sys/wait.h>
 #include <sys/mman.h>
diff -durpN php-7.1.27.orig/ext/posix/config.m4 php-7.1.27/ext/posix/config.m4
--- php-7.1.27.orig/ext/posix/config.m4	2019-03-05 14:28:43.000000000 -0500
+++ php-7.1.27/ext/posix/config.m4	2019-03-26 07:37:30.108299604 -0400
@@ -29,7 +29,10 @@ int main(int argc, char *argv[])
   ],[
     AC_MSG_RESULT([no, posix_ttyname() will be thread-unsafe])
   ], [
-    AC_MSG_RESULT([no, cannot detect working ttyname_r() when cross compiling. posix_ttyname() will be thread-unsafe])
+    AC_CHECK_FUNCS(ttyname_r,
+      [AC_MSG_RESULT([yes])
+       AC_DEFINE(HAVE_TTYNAME_R, 1, [Whether you have a working ttyname_r])],
+      [AC_MSG_RESULT([no, cannot detect working ttyname_r() when cross compiling. posix_ttyname() will be thread-unsafe])])
   ])
 
   AC_CACHE_CHECK([for utsname.domainname], ac_cv_have_utsname_domainname, [
diff -durpN php-7.1.27.orig/ext/standard/config.m4 php-7.1.27/ext/standard/config.m4
--- php-7.1.27.orig/ext/standard/config.m4	2019-03-05 14:28:56.000000000 -0500
+++ php-7.1.27/ext/standard/config.m4	2019-03-26 07:37:30.109299605 -0400
@@ -4,7 +4,7 @@ dnl
 dnl Check if flush should be called explicitly after buffered io
 dnl
 AC_CACHE_CHECK([whether flush should be called explicitly after a buffered io], ac_cv_flush_io,[
-AC_TRY_RUN( [
+PHP_TRY_RUN( [
 #include <stdio.h>
 #include <stdlib.h>
 
@@ -60,7 +60,7 @@ if test "$ac_cv_func_crypt" = "no"; then
 fi
 
 AC_CACHE_CHECK(for standard DES crypt, ac_cv_crypt_des,[
-  AC_TRY_RUN([
+  PHP_TRY_RUN([
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -85,7 +85,7 @@ int main() {
 ])])
 
 AC_CACHE_CHECK(for extended DES crypt, ac_cv_crypt_ext_des,[
-  AC_TRY_RUN([
+  PHP_TRY_RUN([
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -110,7 +110,7 @@ int main() {
 ])])
 
 AC_CACHE_CHECK(for MD5 crypt, ac_cv_crypt_md5,[
-AC_TRY_RUN([
+PHP_TRY_RUN([
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -145,7 +145,7 @@ int main() {
 ])])
 
 AC_CACHE_CHECK(for Blowfish crypt, ac_cv_crypt_blowfish,[
-AC_TRY_RUN([
+PHP_TRY_RUN([
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -177,7 +177,7 @@ int main() {
 ])])
 
 AC_CACHE_CHECK(for SHA512 crypt, ac_cv_crypt_sha512,[
-AC_TRY_RUN([
+PHP_TRY_RUN([
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -208,7 +208,7 @@ int main() {
 ])])
 
 AC_CACHE_CHECK(for SHA256 crypt, ac_cv_crypt_sha256,[
-AC_TRY_RUN([
+PHP_TRY_RUN([
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -356,7 +356,7 @@ dnl
 dnl Check if atof() accepts NAN
 dnl
 AC_CACHE_CHECK(whether atof() accepts NAN, ac_cv_atof_accept_nan,[
-AC_TRY_RUN([
+PHP_TRY_RUN([
 #include <math.h>
 #include <stdlib.h>
 
@@ -387,7 +387,7 @@ dnl
 dnl Check if atof() accepts INF
 dnl
 AC_CACHE_CHECK(whether atof() accepts INF, ac_cv_atof_accept_inf,[
-AC_TRY_RUN([
+PHP_TRY_RUN([
 #include <math.h>
 #include <stdlib.h>
 
@@ -421,7 +421,7 @@ dnl
 dnl Check if HUGE_VAL == INF
 dnl
 AC_CACHE_CHECK(whether HUGE_VAL == INF, ac_cv_huge_val_inf,[
-AC_TRY_RUN([
+PHP_TRY_RUN([
 #include <math.h>
 #include <stdlib.h>
 
@@ -456,7 +456,7 @@ dnl
 dnl Check if HUGE_VAL + -HUGEVAL == NAN
 dnl
 AC_CACHE_CHECK(whether HUGE_VAL + -HUGEVAL == NAN, ac_cv_huge_val_nan,[
-AC_TRY_RUN([
+PHP_TRY_RUN([
 #include <math.h>
 #include <stdlib.h>
 
diff -durpN php-7.1.27.orig/sapi/fpm/config.m4 php-7.1.27/sapi/fpm/config.m4
--- php-7.1.27.orig/sapi/fpm/config.m4	2019-03-05 14:29:02.000000000 -0500
+++ php-7.1.27/sapi/fpm/config.m4	2019-03-26 07:37:30.109299605 -0400
@@ -68,7 +68,7 @@ AC_DEFUN([AC_FPM_CLOCK],
   if test "$have_clock_gettime" = "no"; then
     AC_MSG_CHECKING([for clock_get_time])
 
-    AC_TRY_RUN([ #include <mach/mach.h>
+    PHP_TRY_RUN([ #include <mach/mach.h>
       #include <mach/clock.h>
       #include <mach/mach_error.h>
 
@@ -120,7 +120,7 @@ AC_DEFUN([AC_FPM_TRACE],
   if test "$have_ptrace" = "yes"; then
     AC_MSG_CHECKING([whether ptrace works])
 
-    AC_TRY_RUN([
+    PHP_TRY_RUN([
       #include <unistd.h>
       #include <signal.h>
       #include <sys/wait.h>
diff -durpN php-7.1.27.orig/Zend/Zend.m4 php-7.1.27/Zend/Zend.m4
--- php-7.1.27.orig/Zend/Zend.m4	2019-03-05 14:28:42.000000000 -0500
+++ php-7.1.27/Zend/Zend.m4	2019-03-26 07:37:30.109299605 -0400
@@ -109,7 +109,7 @@ ZEND_CHECK_FLOAT_PRECISION
 dnl test whether double cast to long preserves least significant bits
 AC_MSG_CHECKING(whether double cast to long preserves least significant bits)
 
-AC_TRY_RUN([
+PHP_TRY_RUN([
 #include <limits.h>
 
 int main()
@@ -269,7 +269,7 @@ AC_MSG_RESULT(done)
 dnl test for memory allocation using mmap(MAP_ANON)
 AC_MSG_CHECKING(for memory allocation using mmap(MAP_ANON))
 
-AC_TRY_RUN([
+PHP_TRY_RUN([
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
@@ -314,7 +314,7 @@ int main()
 dnl test for memory allocation using mmap("/dev/zero")
 AC_MSG_CHECKING(for memory allocation using mmap("/dev/zero"))
 
-AC_TRY_RUN([
+PHP_TRY_RUN([
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
